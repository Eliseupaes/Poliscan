<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de Performance - Antenas Colineares</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            overflow-x: hidden;
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .input-field {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.5);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            outline: none;
        }
        
        .metric-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
            border-left: 3px solid #3b82f6;
        }
        
        .canvas-container {
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(71, 85, 105, 0.5);
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 8px;
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }
        
        .blueprint-grid {
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-6">

    <!-- Header -->
    <header class="mb-6 text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-2 gradient-text tracking-tight">
            Antena Colinear Analyzer
        </h1>
        <p class="text-slate-400 text-lg">Ferramenta de Engenharia RF com Desenhos T√©cnicos 2D/3D</p>
    </header>

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <!-- Left Panel: Input Form -->
        <div class="lg:col-span-3 space-y-4">
            <div class="glass-panel rounded-2xl p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2 text-blue-400">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                    Par√¢metros
                </h2>

                <form id="antennaForm" class="space-y-4">
                    
                    <!-- Frequency -->
                    <div class="tooltip" data-tip="Frequ√™ncia central de opera√ß√£o">
                        <label class="block text-sm font-medium text-slate-300 mb-1">Frequ√™ncia</label>
                        <div class="flex gap-2">
                            <input type="number" id="frequency" value="2450" min="1" step="0.1" 
                                class="input-field w-full rounded-lg px-3 py-2 text-white placeholder-slate-500">
                            <select id="freqUnit" class="input-field rounded-lg px-3 py-2 text-white w-20">
                                <option value="MHz">MHz</option>
                                <option value="GHz">GHz</option>
                            </select>
                        </div>
                    </div>

                    <!-- Conductor Material -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Condutor</label>
                        <select id="conductorMaterial" class="input-field w-full rounded-lg px-3 py-2 text-white">
                            <option value="copper" data-conductivity="5.96e7">Cobre (Cu)</option>
                            <option value="aluminum" data-conductivity="3.5e7">Alum√≠nio (Al)</option>
                            <option value="silver" data-conductivity="6.30e7">Prata (Ag)</option>
                            <option value="gold" data-conductivity="4.10e7">Ouro (Au)</option>
                        </select>
                    </div>

                    <!-- Dielectric Material -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Diel√©trico</label>
                        <select id="dielectricMaterial" class="input-field w-full rounded-lg px-3 py-2 text-white">
                            <option value="air" data-vf="1.0" data-er="1.0">Ar (VF=1.0)</option>
                            <option value="ptfe" data-vf="0.695" data-er="2.1">PTFE VF=0.695</option>
                            <option value="pe" data-vf="0.66" data-er="2.3">Polietileno VF=0.66</option>
                            <option value="fr4" data-vf="0.5" data-er="4.4">FR4 VF=0.5</option>
                        </select>
                    </div>

                    <!-- Number of Elements -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">N¬∫ Elementos</label>
                        <input type="number" id="numElements" value="4" min="1" max="20" 
                            class="input-field w-full rounded-lg px-3 py-2 text-white">
                    </div>

                    <!-- Element Length -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Comprimento (mm)</label>
                        <input type="number" id="elementLength" value="61" min="1" step="0.1" 
                            class="input-field w-full rounded-lg px-3 py-2 text-white">
                        <div class="text-xs text-slate-500 mt-1">Œª/2: <span id="suggestedLength" class="text-blue-400 mono-font">61.2</span> mm</div>
                    </div>

                    <!-- Element Spacing -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Espa√ßamento (mm)</label>
                        <input type="number" id="elementSpacing" value="73" min="1" step="0.1" 
                            class="input-field w-full rounded-lg px-3 py-2 text-white">
                        <div class="text-xs text-slate-500 mt-1">5Œª/8: <span id="suggestedSpacing" class="text-blue-400 mono-font">76.5</span> mm</div>
                    </div>

                    <!-- Conductor Diameter -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Di√¢metro (mm)</label>
                        <input type="number" id="conductorDiameter" value="4" min="0.1" step="0.1" 
                            class="input-field w-full rounded-lg px-3 py-2 text-white">
                    </div>

                    <!-- Velocity Factor -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Fator Velocidade</label>
                        <input type="number" id="velocityFactor" value="0.82" min="0.1" max="1.0" step="0.01" 
                            class="input-field w-full rounded-lg px-3 py-2 text-white">
                    </div>

                    <button type="button" id="optimizeBtn" 
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-[1.02] shadow-lg">
                        Otimizar Dimens√µes
                    </button>
                </form>
            </div>
        </div>

        <!-- Center/Right Panel: Visualization & Results -->
        <div class="lg:col-span-9 space-y-4">
            
            <!-- Results Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <div class="metric-card glass-panel rounded-xl p-3">
                    <div class="text-slate-400 text-xs mb-1">Ganho</div>
                    <div class="text-2xl font-bold text-white mono-font"><span id="gainValue">0.0</span> <span class="text-sm text-blue-400">dBi</span></div>
                </div>
                <div class="metric-card glass-panel rounded-xl p-3 border-l-purple-500">
                    <div class="text-slate-400 text-xs mb-1">Imped√¢ncia</div>
                    <div class="text-2xl font-bold text-white mono-font"><span id="impedanceValue">0</span> <span class="text-sm text-purple-400">Œ©</span></div>
                </div>
                <div class="metric-card glass-panel rounded-xl p-3 border-l-green-500">
                    <div class="text-slate-400 text-xs mb-1">VSWR</div>
                    <div class="text-2xl font-bold text-white mono-font"><span id="vswrValue">0.0</span> <span class="text-sm text-green-400">:1</span></div>
                </div>
                <div class="metric-card glass-panel rounded-xl p-3 border-l-orange-500">
                    <div class="text-slate-400 text-xs mb-1">Altura Total</div>
                    <div class="text-2xl font-bold text-white mono-font"><span id="totalHeight">0</span> <span class="text-sm text-orange-400">mm</span></div>
                </div>
            </div>

            <!-- Technical Drawing 2D Section -->
            <div class="glass-panel rounded-2xl p-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-semibold text-slate-300 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path></svg>
                        Desenho T√©cnico de Constru√ß√£o (Vista Lateral)
                    </h3>
                    <div class="flex gap-2 text-xs">
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-yellow-600 border border-yellow-400"></span> Condutor</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-blue-500/60 border border-blue-400"></span> Isolante</span>
                    </div>
                </div>
                <div class="relative h-96 w-full canvas-container rounded-lg overflow-hidden blueprint-grid" id="blueprintContainer">
                    <canvas id="technicalDrawing" class="w-full h-full"></canvas>
                    <div class="absolute top-2 right-2 bg-slate-900/90 px-3 py-2 rounded text-xs text-slate-300 border border-slate-700">
                        <div class="font-semibold text-blue-400 mb-1">ESPECIFICA√á√ïES</div>
                        <div id="specsOverlay">Freq: 2450 MHz | Œª: 122.4 mm</div>
                        <div id="materialsOverlay" class="mt-1 text-slate-400">Cu + PTFE</div>
                    </div>
                </div>
            </div>

            <!-- Bottom Row: 3D View and Radiation Pattern -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                
                <!-- 3D Viewer -->
                <div class="glass-panel rounded-2xl p-4">
                    <h3 class="text-lg font-semibold mb-2 text-slate-300 flex items-center gap-2">
                        <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"></path></svg>
                        Visualiza√ß√£o 3D
                    </h3>
                    <div id="canvas3D" class="w-full h-64 canvas-container rounded-lg relative">
                        <div class="absolute bottom-2 left-2 text-xs text-slate-500 pointer-events-none bg-slate-900/80 px-2 py-1 rounded">
                            üñ±Ô∏è Rotacionar | Scroll Zoom
                        </div>
                        <div id="loading3D" class="absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm rounded-lg">
                            <div class="text-blue-400 animate-pulse">Carregando 3D...</div>
                        </div>
                    </div>
                </div>

                <!-- Radiation Pattern -->
                <div class="glass-panel rounded-2xl p-4">
                    <h3 class="text-lg font-semibold mb-2 text-slate-300 flex items-center gap-2">
                        <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path></svg>
                        Padr√£o de Radia√ß√£o
                    </h3>
                    <div class="relative h-64 w-full canvas-container rounded-lg">
                        <canvas id="radiationCanvas" class="w-full h-full"></canvas>
                    </div>
                </div>
            </div>

            <!-- Technical Specifications Table -->
            <div class="glass-panel rounded-2xl p-4">
                <h3 class="text-lg font-semibold mb-3 text-slate-300">Especifica√ß√µes T√©cnicas Detalhadas</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-slate-300">
                        <thead class="text-xs text-slate-400 uppercase bg-slate-800/50">
                            <tr>
                                <th class="px-4 py-2 rounded-l-lg">Par√¢metro</th>
                                <th class="px-4 py-2">Valor</th>
                                <th class="px-4 py-2">Unidade</th>
                                <th class="px-4 py-2 rounded-r-lg">Especifica√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-700">
                            <tr>
                                <td class="px-4 py-2 font-medium">Comprimento de Onda</td>
                                <td class="px-4 py-2 mono-font text-blue-400" id="specWavelength">122.4</td>
                                <td class="px-4 py-2">mm</td>
                                <td class="px-4 py-2 text-slate-400">Œª = c/f</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 font-medium">Comprimento El√©trico</td>
                                <td class="px-4 py-2 mono-font text-blue-400" id="specElectrical">0.50</td>
                                <td class="px-4 py-2">Œª</td>
                                <td class="px-4 py-2 text-slate-400">√ó VF</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 font-medium">Efici√™ncia Radia√ß√£o</td>
                                <td class="px-4 py-2 mono-font text-green-400" id="specEfficiency">95</td>
                                <td class="px-4 py-2">%</td>
                                <td class="px-4 py-2 text-slate-400">Baseado em œÉ</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 font-medium">Atenua√ß√£o Estimada</td>
                                <td class="px-4 py-2 mono-font text-orange-400" id="specLoss">0.2</td>
                                <td class="px-4 py-2">dB</td>
                                <td class="px-4 py-2 text-slate-400">Perdas ohmicas</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 font-medium">BW @ VSWR 1.5:1</td>
                                <td class="px-4 py-2 mono-font text-purple-400" id="specBW">¬±25</td>
                                <td class="px-4 py-2">MHz</td>
                                <td class="px-4 py-2 text-slate-400">Banda estreita</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const C = 299792458;
        let scene, camera, renderer, controls, antennaGroup;

        const materials = {
            copper: { conductivity: 5.96e7, color: 0xb87333, name: 'Cobre' },
            aluminum: { conductivity: 3.5e7, color: 0xc0c0c0, name: 'Alum√≠nio' },
            silver: { conductivity: 6.30e7, color: 0xe0e0e0, name: 'Prata' },
            gold: { conductivity: 4.10e7, color: 0xffd700, name: 'Ouro' }
        };

        document.addEventListener('DOMContentLoaded', () => {
            init3D();
            setupEventListeners();
            calculateAll();
            setTimeout(() => document.getElementById('loading3D').style.display = 'none', 1000);
        });

        function setupEventListeners() {
            document.querySelectorAll('input, select').forEach(input => {
                input.addEventListener('input', () => {
                    calculateAll();
                    if(input.id === 'frequency' || input.id === 'freqUnit') updateSuggestedDimensions();
                });
            });

            document.getElementById('optimizeBtn').addEventListener('click', optimizeDimensions);
            document.getElementById('dielectricMaterial').addEventListener('change', (e) => {
                document.getElementById('velocityFactor').value = e.target.options[e.target.selectedIndex].dataset.vf;
                calculateAll();
            });

            window.addEventListener('resize', () => {
                if(camera && renderer) {
                    const container = document.getElementById('canvas3D');
                    camera.aspect = container.clientWidth / container.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.clientWidth, container.clientHeig